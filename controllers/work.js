var EventProxy,TagWork,User,Ut,Work,check,config,converter,md;User=require("../proxy").User,Work=require("../proxy").Work,TagWork=require("../proxy").TagWork,check=require("validator").check,EventProxy=require("eventproxy"),config=require("../config").config,Ut=require("../lib/util"),md=require("showdown"),converter=new md.converter,exports.before=function(r,e,o){},exports.homepage=function(r,e,o){var t;return t=EventProxy.create("work","workcount","taglist","users",function(r,o,t,n){var i,c,u;for(i=c=0,u=n.length;u>=0?u>c:c>u;i=u>=0?++c:--c)n[i].avatar=Ut.avatar(n[i].email,280),n[i].description=converter.makeHtml(n[i].description);return e.render("homepage",{worklist:r,workcount:o,taglist:t,users:n})}),Work.getWorkPage(1,9,function(r,e,o){return t.emit("work",e),t.emit("workcount",{count:o,page:1,size:9})}),TagWork.getTagWorks(function(r,e){return t.emit("taglist",e)}),User.getUserAdmins(function(r,e){return t.emit("users",e)})},exports.works=function(r,e,o){},exports.work=function(r,e,o){return Work.getWorkByShortName(r.params.shortname,function(r,o){var t;return null!=o?(t=converter.makeHtml(o.content),e.render("work",{work:o,content:t}),o.visit_count++,o.save()):e.send({error:"404"})})};
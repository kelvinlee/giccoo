var avatar,crypto,decrypt,empty,encrypt,md5,validator,xss;xss=require("xss"),validator=require("validator"),crypto=require("crypto"),exports.format_date=function(e,t){var r,n,a,o,c,p,u,i,s,f,l;if(f=e.getFullYear(),o=e.getMonth()+1,r=e.getDate(),n=e.getHours(),a=e.getMinutes(),u=e.getSeconds(),t&&(p=new Date,c=-(e.getTime()-p.getTime()),s=[1e3,6e4,36e5,864e5],c<s[3])){if(c>0&&c<s[1])return Math.floor(c/s[0]).toString()+" 秒前";if(c>s[1]&&c<s[2])return Math.floor(c/s[1]).toString()+" 分钟前";if(c>s[2])return Math.floor(c/s[2]).toString()+" 小时前"}return o=(10>o?"0":"")+o,r=(10>r?"0":"")+r,n=(10>n?"0":"")+n,a=(10>a?"0":"")+a,u=(10>u?"0":"")+u,i=(new Date).getFullYear(),f=null!=(l=i===f)?l:{"":f+"-"},f+o+"-"+r+" "+n+":"+a},exports.escape=function(e){var t,r,n,a,o;return n=/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,r=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,a=[],t=[],o=String(e).replace(/\r\n/g,"\n").replace("/\r/g","\n"),o="\n\n"+o+"\n\n",o=o.replace(n,function(e){return a.push(e),"span"}),o+="~0",o.replace(r,function(e,r,n){return t.push(r),"\n	block"+n.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`span`/g,function(){return a.shift()}).replace(/\n\tblock/g,function(){return t.shift()}).replace(/~0$/,"").replace(/^\n\n/,"").replace(/\n\n$/,"")})},exports.xss=function(e){return xss(e)},exports.strim=function(e){return validator.trim(e)},exports.recode=function(){return{recode:200,reason:"success"}},exports.str=function(e){return e+""},empty=function(e){return"undefined"==typeof e?!0:""===e?!0:e.length<=0?!0:!1},exports.empty=empty,md5=function(e){var t;return t=crypto.createHash("md5"),t.update(e),e=t.digest("hex")},exports.md5=md5,encrypt=function(e,t){var r,n;return r=crypto.createCipher("aes192",t),n=r.update(e,"utf8","hex"),n+=r.final("hex")},exports.encrypt=encrypt,decrypt=function(e,t){var r,n;return n=crypto.createDecipher("aes192",t),r=n.update(e,"hex","utf8"),r+=n.final("utf8")},exports.decrypt=decrypt,exports.gen_session=function(e,t){var r,n;return r=encrypt(e._id+"	"+e.name+"	"+e.pass+"	"+e.email,config.session_secret),n=2592e6,t.cookie(config.auth_cookie_name,r,{path:"/",maxAge:n})},avatar=function(e,t){var r,n;return null==t&&(t=48),r="http://f.giccoo.com/img/user.jpg",e+="",n="http://www.gravatar.com/avatar/"+md5(e.toLowerCase())+"?d="+r+"&s="+t},exports.avatar=avatar;